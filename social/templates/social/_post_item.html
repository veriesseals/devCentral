{% load static %}
{# Renders a single post. Shared by feed.html and profile.html #}
<article class="post-card">
  <div class="avatar">
    {% if post.author.profile.avatar %}
      <img src="{{ post.author.profile.avatar.url }}" alt="{{ post.author.username }}">
    {% else %}
      <img src="{% static 'img/avatar-default.png' %}" alt="avatar">
    {% endif %}
  </div>

  <div class="content">
    <div class="meta">
      <a class="username" href="{% url 'profile' post.author.username %}">@{{ post.author.username }}</a>
      <span class="time">{{ post.created_at|date:"M d, Y H:i" }}</span>
    </div>

    {% if post.rendered_html %}
      <div class="post-body markdown-output">
        {{ post.rendered_html|safe }}
      </div>
    {% else %}
      <div class="post-body" data-post-body>{{ post.body }}</div>
    {% endif %}

    {% if post.image %}
      <img class="post-image" src="{{ post.image.url }}" alt="post image">
    {% endif %}

    <div class="actions">
      <form action="{% url 'post-react' post.id 'like' %}" method="post" class="inline-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        <button type="submit" class="btn-like">ğŸ‘ {{ post.likes_count }}</button>
      </form>

      <form action="{% url 'post-react' post.id 'dislike' %}" method="post" class="inline-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        <button type="submit" class="btn-dislike">ğŸ‘ {{ post.dislikes_count }}</button>
      </form>

      <form action="{% url 'post-share' post.id %}" method="post" class="inline-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        <button type="submit" class="btn-share">ğŸ” {{ post.shares_count }}</button>
      </form>
    </div>

    <details class="replies">
      <summary>Replies ({{ post.replies.count }})</summary>
      <ul>
        {% for r in post.replies.all %}
          <li><strong>@{{ r.author.username }}</strong> {{ r.body }} <em>{{ r.created_at|date:"M d H:i" }}</em></li>
        {% empty %}
          <li>No replies yet.</li>
        {% endfor %}
      </ul>
      <form action="{% url 'post-reply' post.id %}" method="post">
        {% csrf_token %}
        {{ reply_form.body }}
        <button class="btn" type="submit">Reply</button>
      </form>
    </details>
  </div>
</article>
